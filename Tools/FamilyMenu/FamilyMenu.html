<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å®¶åº­èœå•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }

    /* ä¸»å¸ƒå±€ */
    .container {
      display: flex;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    /* å·¦ä¾§èœå“ç§ç±»å¯¼èˆª */
    .category-nav {
      width: 30%;
      max-width: 120px;
      height: 100%;
      overflow-y: auto;
      background-color: #f5f5f5;
      border-right: 1px solid #e0e0e0;
      padding: 10px 0;
    }

    .category-item {
      padding: 15px 10px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .category-item.active {
      background-color: #e0e0e0;
      font-weight: bold;
    }

    /* å³ä¾§èœå“å±•ç¤ºåŒºåŸŸ */
    .dishes-container {
      flex: 1;
      height: 100%;
      overflow-y: auto;
      padding: 10px;
      padding-bottom: 70px; /* ä¸ºåº•éƒ¨æŒ‰é’®ç•™å‡ºç©ºé—´ */
    }

    .category-title {
      font-size: 18px;
      font-weight: bold;
      margin: 15px 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #e0e0e0;
    }

    .dish-item {
      padding: 12px;
      margin-bottom: 10px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dish-info {
      flex: 1;
      cursor: pointer;
    }

    .dish-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .dish-ingredients {
      font-size: 14px;
      color: #666;
    }

    .add-button {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #4CAF50;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      margin-left: 10px;
      font-size: 20px;
      transition: background-color 0.2s;
    }

    .add-button.selected {
      background-color: #2E7D32;
    }

    /* åº•éƒ¨åŠŸèƒ½æŒ‰é’® */
    .bottom-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    .bottom-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 0 20px;
      cursor: pointer;
    }

    .bottom-button i {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .bottom-button span {
      font-size: 12px;
    }

    .selected-count {
      background-color: #F44336;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      position: absolute;
      top: 5px;
      right: 25%;
      transform: translateX(50%);
    }

    /* èœå“è¯¦æƒ…å¼¹çª— */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 20;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fff;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      padding: 20px;
      max-height: 80%;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0e0e0;
    }

    .modal-section {
      margin-bottom: 15px;
    }

    .modal-section-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .modal-section-content {
      line-height: 1.5;
    }

    /* å·²é€‰èœå“ç®¡ç† */
    .selected-dishes-container {
      padding: 10px 0;
    }

    .selected-dish-item {
      padding: 10px;
      margin-bottom: 10px;
      background-color: #f5f5f5;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .delete-button {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #F44336;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      margin-left: 10px;
      font-size: 16px;
      transition: background-color 0.2s;
    }

    .delete-button:hover {
      background-color: #D32F2F;
    }

    .modal-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
    }

    .modal-button {
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
    }

    .cancel-button {
      background-color: #f5f5f5;
      color: #333;
    }

    .confirm-button {
      background-color: #4CAF50;
      color: white;
    }

    .confirm-button.disabled {
      background-color: #cccccc;
      color: #666666;
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* ç¡®è®¤çª—å£ */
    .confirm-content {
      text-align: center;
    }

    .confirm-title {
      font-size: 18px;
      margin-bottom: 20px;
    }

    .confirm-list {
      text-align: left;
      margin-bottom: 20px;
      max-height: 200px;
      overflow-y: auto;
    }

    .confirm-item {
      padding: 5px 0;
    }

    /* å›¾æ ‡æ ·å¼ */
    .icon {
      font-size: 24px;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- å·¦ä¾§èœå“ç§ç±»å¯¼èˆª -->
  <div class="category-nav" id="categoryNav">
    <!-- ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  </div>

  <!-- å³ä¾§èœå“å±•ç¤ºåŒºåŸŸ -->
  <div class="dishes-container" id="dishesContainer">
    <!-- ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  </div>
</div>

<!-- åº•éƒ¨åŠŸèƒ½æŒ‰é’® -->
<div class="bottom-buttons">
  <div class="bottom-button" id="menuButton">
    <i class="icon">ğŸ“‹</i>
    <span>èœå•</span>
  </div>
  <div class="bottom-button" id="selectedButton">
    <i class="icon">ğŸ›’</i>
    <span>å·²é€‰èœå“</span>
    <div class="selected-count" id="selectedCount" style="display: none;">0</div>
  </div>
</div>

<!-- èœå“è¯¦æƒ…å¼¹çª— -->
<div class="modal" id="dishDetailModal">
  <div class="modal-content">
    <div class="modal-title" id="dishDetailTitle"></div>
    <div class="modal-section">
      <div class="modal-section-title">å…¨éƒ¨ææ–™</div>
      <div class="modal-section-content" id="dishDetailIngredients"></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">åšæ³•</div>
      <div class="modal-section-content" id="dishDetailMethod"></div>
    </div>
  </div>
</div>

<!-- å·²é€‰èœå“ç®¡ç†å¼¹çª— -->
<div class="modal" id="selectedDishesModal">
  <div class="modal-content">
    <div class="modal-title">å·²é€‰èœå“</div>
    <div class="selected-dishes-container" id="selectedDishesContainer">
      <!-- ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="modal-footer">
      <div class="modal-button cancel-button" id="cancelSelectedButton">è¿”å›</div>
      <div class="modal-button confirm-button" id="confirmSelectedButton">å®Œæˆ</div>
    </div>
  </div>
</div>

<!-- ç¡®è®¤çª—å£ -->
<div class="modal" id="confirmModal">
  <div class="modal-content">
    <div class="confirm-content">
      <div class="confirm-title">å·²é€‰èœå“</div>
      <div class="confirm-list" id="confirmList">
        <!-- ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
      <div class="modal-footer">
        <div class="modal-button cancel-button" id="backButton">è¿”å›</div>
        <div class="modal-button confirm-button" id="copyButton">å¤åˆ¶</div>
      </div>
    </div>
  </div>
</div>

<script>
  // å…¨å±€å˜é‡
  let menuData = null;
  let selectedDishes = [];

  // DOMå…ƒç´ 
  const categoryNav = document.getElementById('categoryNav');
  const dishesContainer = document.getElementById('dishesContainer');
  const selectedCount = document.getElementById('selectedCount');
  const selectedButton = document.getElementById('selectedButton');
  const menuButton = document.getElementById('menuButton');
  const dishDetailModal = document.getElementById('dishDetailModal');
  const dishDetailTitle = document.getElementById('dishDetailTitle');
  const dishDetailIngredients = document.getElementById('dishDetailIngredients');
  const dishDetailMethod = document.getElementById('dishDetailMethod');
  const selectedDishesModal = document.getElementById('selectedDishesModal');
  const selectedDishesContainer = document.getElementById('selectedDishesContainer');
  const cancelSelectedButton = document.getElementById('cancelSelectedButton');
  const confirmSelectedButton = document.getElementById('confirmSelectedButton');
  const confirmModal = document.getElementById('confirmModal');
  const confirmList = document.getElementById('confirmList');
  const backButton = document.getElementById('backButton');
  const copyButton = document.getElementById('copyButton');

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', init);

  async function init() {
    try {
      // åŠ è½½èœå•æ•°æ®
      const response = await fetch('menu.json');
      menuData = await response.json();

      // æ¸²æŸ“åˆ†ç±»å¯¼èˆª
      renderCategoryNav();

      // æ¸²æŸ“èœå“
      renderDishes();

      // æ·»åŠ äº‹ä»¶ç›‘å¬
      addEventListeners();
    } catch (error) {
      console.error('åˆå§‹åŒ–å¤±è´¥:', error);
      alert('åŠ è½½èœå•æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚');
    }
  }

  // æ¸²æŸ“åˆ†ç±»å¯¼èˆª
  function renderCategoryNav() {
    categoryNav.innerHTML = '';

    menuData.categories.forEach((category, index) => {
      const categoryItem = document.createElement('div');
      categoryItem.className = 'category-item';
      categoryItem.textContent = category.name;
      categoryItem.dataset.id = category.id;

      // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
      if (index === 0) {
        categoryItem.classList.add('active');
      }

      categoryNav.appendChild(categoryItem);
    });
  }

  // æ¸²æŸ“èœå“
  function renderDishes() {
    dishesContainer.innerHTML = '';

    menuData.categories.forEach(category => {
      // åˆ›å»ºåˆ†ç±»æ ‡é¢˜
      const categoryTitle = document.createElement('div');
      categoryTitle.className = 'category-title';
      categoryTitle.id = `category-${category.id}`;
      categoryTitle.textContent = category.name;
      dishesContainer.appendChild(categoryTitle);

      // åˆ›å»ºèœå“åˆ—è¡¨
      category.dishes.forEach(dish => {
        const dishItem = document.createElement('div');
        dishItem.className = 'dish-item';

        // èœå“ä¿¡æ¯
        const dishInfo = document.createElement('div');
        dishInfo.className = 'dish-info';
        dishInfo.dataset.id = dish.id;

        const dishName = document.createElement('div');
        dishName.className = 'dish-name';
        dishName.textContent = dish.name;

        const dishIngredients = document.createElement('div');
        dishIngredients.className = 'dish-ingredients';
        dishIngredients.textContent = dish.mainIngredients;

        dishInfo.appendChild(dishName);
        dishInfo.appendChild(dishIngredients);

        // æ·»åŠ æŒ‰é’®
        const addButton = document.createElement('div');
        addButton.className = 'add-button';
        addButton.dataset.id = dish.id;
        addButton.textContent = '+';

        // å¦‚æœèœå“å·²é€‰ä¸­ï¼Œæ˜¾ç¤ºå¯¹å‹¾
        if (isDishSelected(dish.id)) {
          addButton.textContent = 'âœ“';
          addButton.classList.add('selected');
        }

        dishItem.appendChild(dishInfo);
        dishItem.appendChild(addButton);

        dishesContainer.appendChild(dishItem);
      });
    });
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  function addEventListeners() {
    // åˆ†ç±»å¯¼èˆªç‚¹å‡»äº‹ä»¶
    categoryNav.addEventListener('click', handleCategoryClick);

    // èœå“ä¿¡æ¯ç‚¹å‡»äº‹ä»¶ï¼ˆæ˜¾ç¤ºè¯¦æƒ…ï¼‰
    dishesContainer.addEventListener('click', handleDishClick);

    // åº•éƒ¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    menuButton.addEventListener('click', handleMenuButtonClick);
    selectedButton.addEventListener('click', handleSelectedButtonClick);

    // å¼¹çª—ç›¸å…³äº‹ä»¶
    dishDetailModal.addEventListener('click', handleModalOutsideClick);
    selectedDishesModal.addEventListener('click', handleModalOutsideClick);
    confirmModal.addEventListener('click', handleModalOutsideClick);

    // å·²é€‰èœå“ç®¡ç†æŒ‰é’®
    cancelSelectedButton.addEventListener('click', () => hideModal(selectedDishesModal));
    confirmSelectedButton.addEventListener('click', handleConfirmSelectedClick);

    // ç¡®è®¤çª—å£æŒ‰é’®
    backButton.addEventListener('click', () => {
      hideModal(confirmModal);
      showModal(selectedDishesModal);
    });
    copyButton.addEventListener('click', handleCopyClick);
  }

  // å¤„ç†åˆ†ç±»ç‚¹å‡»
  function handleCategoryClick(event) {
    const categoryItem = event.target.closest('.category-item');
    if (!categoryItem) return;

    // æ›´æ–°é€‰ä¸­çŠ¶æ€
    document.querySelectorAll('.category-item').forEach(item => {
      item.classList.remove('active');
    });
    categoryItem.classList.add('active');

    // æ»šåŠ¨åˆ°å¯¹åº”åˆ†ç±»
    const categoryId = categoryItem.dataset.id;
    const categoryElement = document.getElementById(`category-${categoryId}`);
    if (categoryElement) {
      categoryElement.scrollIntoView({ behavior: 'smooth' });
    }
  }

  // å¤„ç†èœå“ç‚¹å‡»
  function handleDishClick(event) {
    const dishInfo = event.target.closest('.dish-info');
    const addButton = event.target.closest('.add-button');

    if (dishInfo) {
      // æ˜¾ç¤ºèœå“è¯¦æƒ…
      showDishDetail(dishInfo.dataset.id);
    } else if (addButton) {
      // æ·»åŠ /ç§»é™¤èœå“
      toggleDishSelection(addButton.dataset.id);

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      if (isDishSelected(addButton.dataset.id)) {
        addButton.textContent = 'âœ“';
        addButton.classList.add('selected');
      } else {
        addButton.textContent = '+';
        addButton.classList.remove('selected');
      }

      // æ›´æ–°å·²é€‰æ•°é‡
      updateSelectedCount();
    }
  }

  // å¤„ç†èœå•æŒ‰é’®ç‚¹å‡»
  function handleMenuButtonClick() {
    // æ»šåŠ¨åˆ°é¡¶éƒ¨
    dishesContainer.scrollTop = 0;
  }

  // å¤„ç†å·²é€‰èœå“æŒ‰é’®ç‚¹å‡»
  function handleSelectedButtonClick() {
    renderSelectedDishes();
    showModal(selectedDishesModal);
  }

  // å¤„ç†ç¡®è®¤å·²é€‰èœå“ç‚¹å‡»
  function handleConfirmSelectedClick() {
    // å¦‚æœæŒ‰é’®è¢«ç¦ç”¨ï¼ˆæ²¡æœ‰é€‰ä¸­çš„èœå“ï¼‰ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
    if (confirmSelectedButton.classList.contains('disabled')) {
      return;
    }

    renderConfirmList();
    hideModal(selectedDishesModal);
    showModal(confirmModal);
  }

  // å¤„ç†å¤åˆ¶æŒ‰é’®ç‚¹å‡»
  function handleCopyClick() {
    const text = generateCopyText();
    copyToClipboard(text);
    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    hideModal(confirmModal);
  }

  // å¤„ç†åˆ é™¤èœå“æŒ‰é’®ç‚¹å‡»
  function handleDeleteDishClick(event) {
    const dishId = event.currentTarget.dataset.id;

    // ä»å·²é€‰èœå“ä¸­ç§»é™¤
    toggleDishSelection(dishId);

    // æ›´æ–°å·²é€‰èœå“æ˜¾ç¤º
    renderSelectedDishes();

    // æ›´æ–°å·²é€‰æ•°é‡
    updateSelectedCount();

    // æ›´æ–°ä¸»èœå•ä¸­çš„é€‰æ‹©çŠ¶æ€
    updateMainMenuSelectionState(dishId);
  }

  // å¤„ç†å¼¹çª—å¤–éƒ¨ç‚¹å‡»
  function handleModalOutsideClick(event) {
    if (event.target === event.currentTarget) {
      hideModal(event.currentTarget);
    }
  }

  // æ˜¾ç¤ºèœå“è¯¦æƒ…
  function showDishDetail(dishId) {
    const dish = findDishById(dishId);
    if (!dish) return;

    dishDetailTitle.textContent = dish.name;
    dishDetailIngredients.textContent = dish.allIngredients;
    dishDetailMethod.textContent = dish.method;

    showModal(dishDetailModal);
  }

  // æ¸²æŸ“å·²é€‰èœå“
  function renderSelectedDishes() {
    selectedDishesContainer.innerHTML = '';

    // æ ¹æ®æ˜¯å¦æœ‰é€‰ä¸­çš„èœå“æ¥è®¾ç½®å®ŒæˆæŒ‰é’®çš„çŠ¶æ€
    if (selectedDishes.length === 0) {
      // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„èœå“ï¼Œç¦ç”¨å®ŒæˆæŒ‰é’®
      confirmSelectedButton.classList.add('disabled');

      const emptyMessage = document.createElement('div');
      emptyMessage.textContent = 'æš‚æ— å·²é€‰èœå“';
      emptyMessage.style.textAlign = 'center';
      emptyMessage.style.padding = '20px 0';
      selectedDishesContainer.appendChild(emptyMessage);
      return;
    } else {
      // å¦‚æœæœ‰é€‰ä¸­çš„èœå“ï¼Œå¯ç”¨å®ŒæˆæŒ‰é’®
      confirmSelectedButton.classList.remove('disabled');
    }

    selectedDishes.forEach(dishId => {
      const dish = findDishById(dishId);
      if (!dish) return;

      const selectedDishItem = document.createElement('div');
      selectedDishItem.className = 'selected-dish-item';

      // èœå“åç§°
      const dishName = document.createElement('div');
      dishName.textContent = dish.name;

      // åˆ é™¤æŒ‰é’®
      const deleteButton = document.createElement('div');
      deleteButton.className = 'delete-button';
      deleteButton.textContent = 'Ã—';
      deleteButton.dataset.id = dishId;
      deleteButton.addEventListener('click', handleDeleteDishClick);

      selectedDishItem.appendChild(dishName);
      selectedDishItem.appendChild(deleteButton);

      selectedDishesContainer.appendChild(selectedDishItem);
    });
  }

  // æ¸²æŸ“ç¡®è®¤åˆ—è¡¨
  function renderConfirmList() {
    confirmList.innerHTML = '';

    selectedDishes.forEach(dishId => {
      const dish = findDishById(dishId);
      if (!dish) return;

      const confirmItem = document.createElement('div');
      confirmItem.className = 'confirm-item';
      confirmItem.textContent = dish.name;

      confirmList.appendChild(confirmItem);
    });
  }

  // ç”Ÿæˆå¤åˆ¶æ–‡æœ¬
  function generateCopyText() {
    let text = 'ä»Šæ—¥èœå•ï¼š\n\n';

    selectedDishes.forEach(dishId => {
      const dish = findDishById(dishId);
      if (!dish) return;

      text += `ã€${dish.name}ã€‘\n`;
      text += `ææ–™ï¼š${dish.allIngredients}\n`;
      text += `åšæ³•ï¼š\n${dish.method}\n\n`;
    });

    return text;
  }

  // å¤åˆ¶åˆ°å‰ªè´´æ¿
  function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = 0;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
  }

  // æ˜¾ç¤ºå¼¹çª—
  function showModal(modal) {
    modal.style.display = 'flex';
  }

  // éšè—å¼¹çª—
  function hideModal(modal) {
    modal.style.display = 'none';
  }

  // åˆ‡æ¢èœå“é€‰æ‹©çŠ¶æ€
  function toggleDishSelection(dishId) {
    const index = selectedDishes.indexOf(dishId);
    if (index === -1) {
      selectedDishes.push(dishId);
    } else {
      selectedDishes.splice(index, 1);
    }
  }

  // åˆ¤æ–­èœå“æ˜¯å¦å·²é€‰ä¸­
  function isDishSelected(dishId) {
    return selectedDishes.includes(dishId);
  }

  // æ›´æ–°å·²é€‰æ•°é‡
  function updateSelectedCount() {
    const count = selectedDishes.length;
    selectedCount.textContent = count;

    if (count > 0) {
      selectedCount.style.display = 'flex';
    } else {
      selectedCount.style.display = 'none';
    }
  }

  // æ ¹æ®IDæŸ¥æ‰¾èœå“
  function findDishById(dishId) {
    for (const category of menuData.categories) {
      for (const dish of category.dishes) {
        if (dish.id === dishId) {
          return dish;
        }
      }
    }
    return null;
  }

  // æ›´æ–°ä¸»èœå•ä¸­çš„é€‰æ‹©çŠ¶æ€
  function updateMainMenuSelectionState(dishId) {
    // æŸ¥æ‰¾ä¸»èœå•ä¸­å¯¹åº”çš„æ·»åŠ æŒ‰é’®
    const addButton = document.querySelector(`.add-button[data-id="${dishId}"]`);
    if (addButton) {
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      if (isDishSelected(dishId)) {
        addButton.textContent = 'âœ“';
        addButton.classList.add('selected');
      } else {
        addButton.textContent = '+';
        addButton.classList.remove('selected');
      }
    }
  }
</script>
</body>
</html>